## Методическое пособие по расчёту стоимости монтажных работ

### 1. Назначение документа
- Описать единый порядок преобразования входящего запроса (перечень оборудования, ожидаемый объём работ, условия объекта) в смету монтажных работ.
- Дать инструкции менеджеру/инженеру или ИИ‑агенту по выявлению состава работ, расчёту трудозатрат, командировочных и накладных расходов.
- Установить контрольные точки для проверки полноты расчёта и согласованности с коммерческим предложением.

**КРИТИЧЕСКИ ВАЖНО для ИИ‑агента (Ассистента):**
- **Обязательное завершение проекта:** Агент должен доделывать проект до полного завершения, пока не выполнит все задачи из файла `TODO.md` проекта (кроме задач, требующих ручной работы или независимого специалиста).
- **Непрерывная работа:** Агент не должен останавливаться на середине проекта. Если в `TODO.md` остались невыполненные задачи, которые можно выполнить автоматически или с помощью Агента, работа должна продолжаться до их завершения.
- **Проверка TODO.md:** Перед завершением работы над проектом Агент обязан проверить файл `TODO.md` и убедиться, что все автоматически выполнимые задачи отмечены как выполненные `[x]`.
- **Задачи, требующие ручной работы:** Если в `TODO.md` остались задачи, которые требуют ручной работы (например, "требуется ручной поиск оборудования", "требует независимого специалиста"), Агент должен четко указать эти задачи в итоговом отчете и отметить их статус, но не останавливать работу на этом этапе.
- **Обновление TODO.md:** Агент должен обновлять файл `TODO.md` после выполнения каждой задачи, отмечая выполненное как `[x]` и добавляя комментарии при необходимости.

### 2. Обязательные входные данные
- **Исходное оборудование:** спецификация с типами, количеством, массой и габаритами единиц.
- **Технические требования:** схема размещения, высоты подвеса, требования к скрытой прокладке, требования к тестированию.
- **Условия площадки:** город/населённый пункт, доступность электроэнергии, режим работы площадки, пропускной режим, необходимость высотных работ.
- **Сроки:** окно монтажа, доступность помещения, дата ввода в эксплуатацию.
- **Требуемые дополнительные сервисы:** проектирование, авторский надзор, обучение персонала.

Если часть данных отсутствует, фиксируем допущения, запрашиваем уточнения у заказчика и отмечаем риски в смете.

### 3. Организация работы с прайсами и структура проектов
- **Папка "Прайсы":**
  - используется исключительно как справочная база для расчёта стоимости оборудования;
  - содержит актуальные прайс-листы поставщиков в исходном формате (Excel, PDF);
  - **строго запрещено:** изменять, удалять, перемещать файлы из папки "Прайсы";
  - **разрешено только:** чтение файлов для извлечения цен и характеристик оборудования;
  - для ускорения поиска допускается использовать агрегированный файл `aggregated_pricelist.xlsx` (единый лист из всех страниц всех прайсов, колонки `source_file`, `sheet_name`, `row_number`, `col_1...`); он создаётся отдельно и не заменяет оригиналы. При ссылках на цену всё равно указываем исходный прайс: файл, лист, строка.
  - при необходимости обновления прайсов — создавать копию в отдельной папке проекта или согласовывать обновление с ответственным за базу данных.
  - **запрещено придумывать цены или ссылки:** если позиция не найдена в указанном файле/строке прайса, цену не ставим; переходим к интернет-поиску или ставим цену `0` с пометкой «ТРЕБУЕТСЯ ПОИСК».
- **Структура проектов:**
  - для каждого нового проекта создаётся отдельная папка с названием по шаблону: `Расчет_[Название_проекта]` или `Проект_[Клиент]_[Дата]`;
  - в папке проекта размещаются:
    - спецификация оборудования проекта;
    - сводная таблица с ценами из прайсов (копия, не исходные файлы);
    - расчётные таблицы (сметы, трудозатраты, командировки);
    - документация по монтажу (если разрабатывается);
    - шаблоны писем для резервирования заказа поставщиков (с указанием позиций, количества, сроков поставки, условий оплаты);
    - итоговые коммерческие предложения и отчёты;
  - папка "Прайсы" остаётся общей для всех проектов и не копируется в папки проектов.
  - **Папка "Обработанный проект":**
    - используется для хранения всех завершённых и обработанных проектов;
    - **строго запрещено:** размещать файлы напрямую в папке "Обработанный проект";
    - **разрешено только:** создавать подпапки проектов (например, `Проект_2_Бассейн_Нижний_Тагил`, `Проект_3_Бассейн_Петропавловск`);
    - все файлы проекта (расчёты, таблицы, PDF, документация) должны находиться внутри подпапки конкретного проекта;
    - структура: `Обработанный проект/Проект_[Название]/` — все файлы конкретного проекта размещаются в его подпапке;
    - засорение папки "Обработанный проект" файлами запрещено — это нарушает организацию и усложняет навигацию.
- **Правила работы:**
  - **Определение сегмента оборудования:** перед началом подбора оборудования для проекта необходимо определить целевой сегмент (бюджетный, среднебюджетный или премиальный) на основе требований заказчика, бюджета проекта и условий эксплуатации. **Строго запрещено смешивать оборудование разных сегментов в одном коммерческом предложении.** Все позиции в КП должны относиться к одному выбранному сегменту. Если требуется предложить несколько вариантов — создаются отдельные КП для каждого сегмента.
  - **Правило для разных вариантов решения:** если для одного проекта требуется предложить несколько вариантов решения (например, готовые кабинеты LED со встроенными модулями ИЛИ пустые кабинеты + модули отдельно), то **каждый вариант должен быть оформлен в отдельной вкладке Excel-файла** (например, "Вариант А: Готовые кабинеты", "Вариант Б: Кабинеты + модули"). В сводной таблице оба варианта указываются отдельно с пометкой. **Строго запрещено** суммировать стоимость разных вариантов в одну смету — это приведет к двойному учету стоимости. В итоговой смете выбирается один вариант по согласованию с заказчиком. Если разные варианты относятся к разным сегментам оборудования, то создаются отдельные КП для каждого варианта.
  - при расчёте стоимости оборудования извлекаем данные из папки "Прайсы" и создаём рабочую таблицу в папке проекта, **учитывая выбранный сегмент и подбирая оборудование соответствующего уровня;**
  - если в прайсах отсутствует нужное оборудование — используем раздел 9 (Поиск компонентов агентом) и сохраняем результаты в папку проекта, **при этом все найденные варианты должны соответствовать выбранному сегменту;**
  - **обязательное требование:** для каждой позиции оборудования **точно указываем источник цены:**
    - **Если оборудование из прайса:** указываем полное название файла прайса, название листа (если применимо) и номер строки, где находится позиция. Формат: `[Название_файла.xlsx], лист "[Название_листа]", строка [номер]`. Пример: `Intrend_звуковое оборудование_прайс-лист_210725.xlsx, лист "Лист1", строка 45`. **КРИТИЧЕСКИ ВАЖНО:** перед указанием источника из прайс-листа необходимо проверить реальное наличие позиции в указанной строке. Если позиция не найдена в строке или строка не существует, **запрещено** указывать ссылку на прайс-лист — это создает ложные ссылки на несуществующие позиции. В этом случае требуется поиск в интернете.
    - **Если оборудование из интернета:** указываем полную ссылку (URL) на страницу товара и цену, которая была найдена на момент поиска. Формат: `[Полная ссылка] - цена [сумма] руб (на [дата])`. Пример: `https://www.auvix.ru/catalog/zvukovoe-oborudovanie/miksheery/midas-m32r/ - цена 450000 руб (на 20.11.2025)`. **КРИТИЧЕСКИ ВАЖНО:** поиск оборудования должен проводиться на российских сайтах в первую очередь (snk-s.ru, auvix.ru, digis.ru, hi-tech-media.ru, затем Wildberries, Ozon, Яндекс.Маркет и другие российские сайты). Только если не найдено на российских сайтах — поиск в общем интернете.
  - все ссылки на источники цен фиксируем в расчётных таблицах в колонке "Источник";
  - при обновлении прайсов в базе — пересчитываем только те проекты, которые находятся в стадии подготовки сметы.
  - **Контроль достоверности цен:**
    - перед использованием строки из прайса обязательно проверяем её фактическое наличие (файл, лист, строка). Если строка отсутствует или товар другой — **не указывать** этот источник; зафиксировать «не найдено» и перейти к интернет-поиску.
    - для интернет-ссылок сохраняем полную URL, дату и найденную цену; если цены нет, ставим `0` и пометку «требуется актуализация».
    - любые «примерные» или оценочные цены без источника запрещены; допускается только `0` с явной пометкой о необходимости ручного поиска.
    - в итоговых таблицах/КП исключены выдуманные названия/строки; вся информация должна быть подтверждена ссылкой или явно отмечена как требующая поиска.

### 4. Базовые нормативы и коэффициенты
- **Базовая ставка монтажника:** 625 ₽ за час (эквивалент ~5 000 ₽ за стандартную 8‑часовую смену). При ином режиме работы фиксируем фактическое количество часов.
- **Продолжительность смены:** по умолчанию 8 часов. Ночные смены и сверхурочные тарифицируются с коэффициентами:
  - ночные работы: ×1.25;
  - работы в выходные/праздники: ×1.5;
  - часы сверх 10 часов в смену: ×2.
- **Старший монтажник / прораб:** ставка ×1.4 от базовой (875 ₽/час).
- **Инженер ПНР (пуско‑наладочные работы):** ставка ×1.6 (1 000 ₽/час).
- **Руководитель отдела исполнения:** ставка ×1.8 (1 125 ₽/час). Участвует в предпроектной подготовке, контроле графиков, ключевых выездах, сдаче проекта.
- **Специалист по закупкам / логист:** ставка ×1.3 (815 ₽/час).
- **Коэффициенты сложности** (применяются к трудозатратам):
  - высотные работы выше 5 м: ×1.2;
  - монтаж тяжёлого оборудования (>80 кг) или крупногабаритных конструкций: ×1.3;
  - работа в действующем производстве / строгий пропускной режим: ×1.15;
  - удалённые объекты (время в пути >4 часов на авто/поезде): добавляем день на дорогу туда и обратно в трудозатраты.

Коэффициенты суммируются мультипликативно. Например, для тяжёлого оборудования на высоте: 625 ₽ × 1.2 × 1.3.

### 5. Определение состава работ
1. **Классифицировать оборудование.** Для каждой позиции определить тип операции: монтаж подвесной конструкции, крепление на стене, установка в стойке, прокладка кабелей, настройка ПО, обучение.
2. **Выбрать шаблон операции** (см. таблицу ниже) и скорректировать под условия объекта.
3. **Зафиксировать дополнительные требования:** аренда подъёмников, лесов, специнструмента, расходных материалов, согласования.
4. **Определить последовательность работ:** подготовка → доставка → монтаж → коммутация → тестирование → сдача.

#### Пример шаблонов операций
| Операция | Базовая трудоёмкость (чел.-ч на единицу) | Минимальный состав бригады | Доп. примечания |
|---|---|---|---|
| Подвес LED-экрана 5–10 м² | 16 | 3 монтажника + 1 прораб | Нужны такелажные средства, при высоте >5 м коэффициент 1.2 |
| Монтаж стойки/шкафа с коммутацией | 6 | 2 монтажника | При весе >120 кг добавить 1 монтажника |
| Прокладка кабеля категории 6 (канал до 100 м) | 8 | 2 монтажника | На каждые дополнительные 50 м +2 чел.-ч |
| Настройка и тестирование оборудования | 4 | 1 инженер ПНР | При интеграции нескольких систем умножаем ×1.3 |
| Обучение персонала (группа до 5 чел.) | 3 | 1 инженер ПНР | Допускается онлайн-формат (коэффициент 0.7) |

Таблицу дополняем под специфичное оборудование проекта.

### 6. Расчёт трудозатрат
1. Для каждой операции: `Трудозатраты (чел.-ч) = Базовая трудоёмкость × Количество единиц × Коэффициенты сложности`.
2. Полученную величину делим на продолжительность смены, округляем вверх — получаем количество смен для состава бригады.
3. Распределяем трудозатраты между ролями (монтажники, прораб, инженер ПНР). Если операция требует разной квалификации, используем долевое распределение.
4. **Сопровождение руководителем отдела исполнения.** Нормируем:
   - предпроектная подготовка (проверка исходных данных, согласование состава работ) — минимум 4 часа;
   - координация монтажа — 0.5 часа на каждую смену бригады (распределяется равномерно по календарю проекта);
   - контроль выезда / сдача — 4 часа на старт и 4 часа на финальную сдачу;
   - при параллельных бригадах коэффициент 1.5 к времени координации.
   Итоговое время руководителя = `4 + 0.5 × Количество смен × Коэффициент параллельности + 8`. Часы включаем в смету по ставке 1 125 ₽/час.

**Пример:** монтаж LED-экрана 6×4 м (24 м²) в актовом зале (высота 6 м, масса секции 600 кг).  
Базовая трудоёмкость (принимаем как 24 чел.-ч). Коэффициенты: высота 1.2, тяжесть 1.3.  
`24 × 1.2 × 1.3 = 37.4 чел.-ч`. При смене 8 ч → 4.7 смен ≈ 5 смен.  
Бригада 3 монтажника + прораб. Часы: монтажники 3 × 5 × 8 = 120, прораб 5 × 8 = 40.  
Стоимость: монтажники 120 × 625 = 75 000 ₽; прораб 40 × 875 = 35 000 ₽. Итого 110 000 ₽.  
Добавим инженер ПНР: 2 смены × 8 ч = 16 ч × 1 000 = 16 000 ₽. Общая трудовая часть 126 000 ₽ (без командировок).
Руководитель отдела исполнения: `(4 + 0.5 × 5 + 8) = 14.5 ч × 1 125 ≈ 16 312 ₽`. Общая трудовая часть с сопровождением — 142 000 ₽.

### 7. Нормирование затрат на закуп оборудования
- **Объём работ:**
  - анализ спецификации и проверка совместимости — 0.25 часа на позицию;
  - сбор коммерческих предложений (минимум 3 поставщика) — 0.5 часа на позицию или группу однотипного оборудования;
  - согласование условий и формирование заказа — 1 час на заявку;
  - логистика и контроль поставки — 0.5 часа на каждую отправку + 0.25 часа на единицу крупногабарита (>50 кг);
  - оформление первичных документов и ввод в учёт — 0.2 часа на позицию.
- **Коэффициенты:**
  - импортные поставки или дефицитные позиции — ×1.3 к времени на поиск и согласование;
  - единичные изделия с кастомизацией — ×1.2;
  - при работе по срочным срокам (<5 рабочих дней до монтажа) — ×1.5.
- **Расходы:**
  - труд специалиста по закупкам рассчитываем по ставке 815 ₽/час;
  - закладываем резерв на колебание цен 3–5 % от стоимости оборудования;
  - логистические расходы (доставка, страхование, таможня) включаем отдельной строкой по фактическим ставкам или нормативам (например, 2 % для федеральных поставщиков, 5 % для региональных/долгих доставок).
- **Результат:** в смете появляется блок `Закуп оборудования` со строками:
  - стоимость оборудования (по коммерческим предложениям);
  - трудозатраты закупщика (по формуле выше);
  - логистика/страхование;
  - резерв на рост цен.
- **Шаблоны писем для резервирования заказа:**
  - после согласования условий с поставщиком формируем письмо-заявку на резервирование;
  - шаблон письма сохраняется в папку проекта с именем: `Письмо_резервирование_[Поставщик]_[Дата].docx` или `.txt`;
  - обязательные элементы шаблона:
    - наименование проекта и заказчика;
    - перечень позиций с артикулами, количеством, ценами;
    - сроки поставки (желаемые и максимально допустимые);
    - условия оплаты (предоплата, рассрочка, отсрочка);
    - условия резервирования (срок действия резерва, условия снятия);
    - требования к упаковке и маркировке;
    - контактные данные ответственного за закупку;
  - для каждого поставщика создаётся отдельный шаблон письма;
  - после отправки письма сохраняем копию в папку проекта с пометкой "Отправлено" и датой.

### 8. Разработка документации по монтажу и соединению оборудования
- **Цель:** обеспечить понятный комплект инструкций для бригад и заказчика, минимизировать ошибки при монтаже.
- **Ответственные:** ведущий инженер проекта (ставка ×1.6 = 1 000 ₽/час) при участии руководителя отдела исполнения.
- **Состав материалов:**
  - спецификация оборудования с указанием узлов подключения;
  - **структурная схема соединения компонентов** — обязательный элемент документации, который должен быть включен в PDF коммерческого предложения. Схема должна показывать все основные компоненты системы, их взаимосвязи, типы соединений (аналоговые, цифровые, сетевые, силовые), направления сигналов, точки подключения. Схема может быть выполнена в виде блок-схемы, функциональной схемы или принципиальной схемы соединений в зависимости от сложности проекта;
  - **структурная схема соединения компонентов в формате Visio** — обязательный дополнительный файл, который должен быть создан для каждого проекта. Файл должен быть сохранен в формате `.vsdx` (Microsoft Visio) или `.vsd` (старый формат Visio). Схема в Visio должна содержать:
    - **Блоки оборудования:** каждый компонент системы представлен в виде прямоугольного блока с названием оборудования, моделью и основными портами/разъемами (HDMI OUT, HDMI IN, USB, RJ45, LAN и т.д.);
    - **Соединения:** все соединения между компонентами показаны линиями со стрелками, указывающими направление сигнала;
    - **Правило неделимости проводов:** **КРИТИЧЕСКИ ВАЖНО: провода между компонентами являются неделимыми и не могут идти по нескольку раз провода одного типа.** Если между двумя компонентами требуется несколько проводов одного типа (например, 3 XLR кабеля, 2 HDMI кабеля), то на схеме должен быть показан один провод с указанием количества в подписи (например, "XLR × 3", "HDMI × 2"). **Строго запрещено** показывать несколько отдельных проводов одного типа между одними и теми же компонентами — это усложняет схему и создает визуальный мусор. Каждый тип провода между двумя конкретными компонентами должен быть представлен одной линией с указанием количества;
    - **Типы соединений:** каждый кабель/соединение должен быть подписан типом (HDMI, USB, RJ45, XLR, LAN, аналоговый, цифровой и т.д.) и количеством, если проводов несколько (например, "XLR × 6", "HDMI × 2");
    - **Детализация компонентов:** **КРИТИЧЕСКИ ВАЖНО: схема должна быть детализирована покомпонентно без объединений в группы.** Каждый компонент должен быть показан отдельно, даже если их несколько штук. Например, если в проекте 6 микрофонов Октава OWS 1200 H, то на схеме должно быть 6 отдельных блоков "Микрофон Октава OWS 1200 H", каждый со своим номером (№1/6, №2/6 и т.д.). Если 2 колонки, то должно быть 2 отдельных блока "Колонка активная 350Вт", каждый со своим номером (№1/2, №2/2). **Строго запрещено объединять компоненты в группы** типа "Микрофоны (12)" или "Колонки (2)". Функциональные зоны (входные источники, обработка, выходные устройства) могут быть обозначены только как области расположения компонентов, но сами компоненты внутри зон должны быть показаны отдельно;
    - **Легенда:** схема должна содержать легенду с расшифровкой типов соединений и обозначений;
    - **Масштабируемость:** схема должна быть выполнена в масштабе, удобном для печати на формате A3 или A4;
    - **Читаемость:** все надписи должны быть читаемыми, размер шрифта не менее 8pt;
    - **Цветовое кодирование:** рекомендуется использовать цветовое кодирование для разных типов сигналов (например, HDMI - синий, USB - зеленый, сетевые - оранжевый);
    - **Нумерация портов:** все порты на блоках должны быть пронумерованы или названы (HDMI IN 1, HDMI IN 2, OUT 1, OUT 2 и т.д.);
    - **Пример структуры:** схема должна следовать логике потока сигналов: входные источники (слева) → обработка/коммутация (центр) → выходные устройства (справа);
  - схемы размещения (планы, разрезы) с привязками к конструкциям;
  - кабельные журналы, маркировочные ведомости, схемы соединений (силовые, слаботочные, сетевые);
  - инструкции по пуско‑наладке, чекают-листы тестов, требования к среде (электропитание, климат);
  - план-график монтажа и перечень контрольных точек;
  - журнал изменений/редакций и бланк замечаний от заказчика.
- **Норматив времени:** 
  - базовая подготовка пакета — 6 часов на проект;
  - дополнительно 0.5 часа на каждую уникальную позицию оборудования;
  - на каждую отдельную площадку/зону — +2 часа;
  - при наличии BIM-модели или необходимой 3D-визуализации — коэффициент 1.3;
  - если заказчик предоставляет часть документации, снижаем норматив на 20 % после проверки совместимости.
- **Проверка:** руководитель отдела исполнения выделяет 1 час на ревью и фиксацию замечаний; замечания от заказчика обрабатываются в течение 0.2 часа на пункт.
- **Выходной пакет:** PDF/журналы + исходные файлы (CAD, Visio, BIM) с версионностью и ссылками в хранилище проекта.
- **Норматив времени на создание схемы в Visio:**
  - базовая схема (до 10 компонентов) — 2 часа;
  - средняя схема (10-20 компонентов) — 3 часа;
  - сложная схема (более 20 компонентов) — 4 часа;
  - дополнительно 0.2 часа на каждый дополнительный тип соединения или функциональную зону;
  - при необходимости создания нескольких схем для разных подсистем — умножаем норматив на количество схем.

### 9. Поиск компонентов и материалов в интернете (агент)
- **Триггеры запуска:** отсутствует позиция на складе, требуется подбор альтернативы, поиск специнструмента или аренды техники, **позиция не найдена в указанной строке прайс-листа**.
- **КРИТИЧЕСКИ ВАЖНО:** перед указанием источника из прайс-листа необходимо проверить реальное наличие позиции в указанной строке. Если позиция не найдена в строке или строка не существует, **запрещено** указывать ссылку на прайс-лист — это создает ложные ссылки на несуществующие позиции. В этом случае требуется поиск в интернете.
- **Алгоритм:**
  1. **Проверка наличия в прайс-листах:** если источник указывает на прайс-лист, проверить реальное наличие позиции в указанной строке. Если позиция не найдена — перейти к поиску в интернете.
  2. Сформировать запрос из спецификации: наименование, ключевые характеристики, допустимые аналоги, желаемые условия (цена, срок).
  3. **Агент выполняет поиск на российских сайтах в первую очередь (ОБЯЗАТЕЛЬНО):**
     - Приоритетные ресурсы: https://snk-s.ru/, https://www.auvix.ru/, https://digis.ru/, https://hi-tech-media.ru
     - Другие российские сайты: Wildberries, Ozon, Яндекс.Маркет, специализированные магазины
     - Только если не найдено на российских сайтах — поиск в общем интернете
  4. Результаты нормализуются в таблицу: поставщик, ссылка, наличие, базовая цена, срок поставки, условия доставки/оплаты, контакт.
  5. Агент помечает уровень доверия (1–3) и указывает дату/время проверки.
  6. Для критичных компонентов собираем минимум 3 предложения; при дефиците фиксируем это в отчёте.
  7. **Обязательное указание источника:** для каждой найденной позиции указывается полная ссылка (URL) на страницу товара, цена и дата поиска.
- **Норматив времени:** 0.4 часа на позицию при наличии предложения, 0.7 часа если требуется поиск альтернатив; коэффициент 1.2 для импортных/редких компонентов.
- **Контроль:** специалист по закупкам проверяет результаты (0.1 часа/позиция), руководитель утверждает выбранные позиции (0.05 часа/позиция). В случае сомнений делаем выборочные звонки поставщикам.
- **Интеграция с закупом:** найденные цены и условия импортируются в блок `Закуп оборудования`, указываем источник и ссылку для последующего заказа.
- **Поиск недостающего оборудования:** если позиция отсутствует в папке «Прайсы», используем интернет-источники. **Обязательный порядок поиска:**
  1. **Приоритетные ресурсы (поиск в первую очередь):**
     - https://snk-s.ru/ — специализированный поставщик профессионального оборудования
     - https://www.auvix.ru/ — дистрибьютор аудио-видео оборудования
     - https://digis.ru/ — поставщик цифрового и мультимедийного оборудования
     - https://hi-tech-media.ru — поставщик профессионального AV-оборудования
  2. **Дополнительные источники (если не найдено на приоритетных):**
     - Официальные сайты производителей
     - Маркетплейсы (Wildberries, Ozon и др.)
     - Специализированные форумы и каталоги
     - Общий поиск в интернете
  3. **Обязательные шаги:**
     - Если позиция отсутствует в прайсах, **обязательно используем встроенный браузер и поисковик Яндекс**: для каждой позиции открываем браузер, собираем информацию о товаре (ссылка, цена, наличие, дата), затем сохраняем результаты в рабочую таблицу проекта (колонки: наименование, ссылка, цена, дата, комментарий). Только после фиксации проверенных данных в таблице переносим цену и источник в смету/КП.
     - **Определить сегмент оборудования:** перед началом подбора необходимо определить целевой сегмент для всего проекта:
       - **Бюджетный сегмент:** оборудование начального уровня, доступные бренды (например, Behringer, Alto, Mackie, бюджетные линейки Shure, бюджетные модели Intrend)
       - **Среднебюджетный сегмент:** оборудование среднего класса, проверенные бренды (например, Yamaha, Soundcraft, средние линейки Shure, средние модели Intrend, Midas M32 серия)
       - **Премиальный сегмент:** профессиональное оборудование высокого класса (например, Midas Pro серия, Shure Axient, Neumann, высокие линейки Audio-Technica, премиальные модели Intrend)
     - **Правило единообразия сегмента:** **строго запрещено смешивать оборудование разных сегментов в одном коммерческом предложении.** Все позиции в КП должны относиться к одному выбранному сегменту (бюджетный, среднебюджетный или премиальный). Если требуется предложить несколько вариантов — создаются отдельные КП для каждого сегмента.
     - **Подбор по брендам:** при подборе оборудования учитывать совместимость брендов и их принадлежность к одному сегменту. Например, если выбран премиальный сегмент — все позиции должны быть из премиальных брендов, а не смешивать бюджетные и премиальные марки.
     - найти минимум **три** предложения (официальные поставщики, маркетплейсы, дистрибьюторы);
     - для каждой позиции фиксировать цену, наличие, срок поставки, ссылку на страницу и контакт;
     - **обязательно указывать полную ссылку (URL) на страницу товара и цену** для каждого найденного варианта;
     - сравнить предложения и обосновать выбранный вариант (цена, срок, гарантия, регион, соответствие сегменту);
     - сохранить результаты сравнения в таблице `Поиск_[Наименование]_YYYYMMDD.xlsx` и приложить к материалам проекта;
     - в итоговой таблице расчета оборудования в колонке "Источник" указывать:
       - для прайсов: `[Название_файла.xlsx], лист "[Название_листа]", строка [номер]`
       - для интернета: `[Полная ссылка] - цена [сумма] руб (на [дата])`
     - **В обосновании выбора оборудования обязательно указать выбранный сегмент** и обосновать, почему выбран именно этот сегмент для проекта
  4. **Поиск изображений оборудования:**
     - **ОБЯЗАТЕЛЬНО:** Для каждой позиции оборудования необходимо найти изображение в интернете либо поставить заглушку
     - **Обязательно стараемся найти все изображения оборудования** для каждой позиции
     - Изображения ищем на тех же приоритетных ресурсах (snk-s.ru, auvix.ru, digis.ru, hi-tech-media.ru)
     - Если не найдено на приоритетных ресурсах — ищем на сайтах производителей и в общем интернете
     - Все найденные изображения сохраняем в папку проекта `img/` с именами вида `[Номер_позиции]_[Краткое_название].jpg`
     - **Если изображение не найдено:** необходимо создать и сохранить заглушку (стандартное изображение-заглушку с текстом "Изображение не найдено" или схематичное изображение оборудования) в папку `img/` с соответствующим именем файла
     - Заглушка должна быть вставлена в PDF вместо отсутствующего изображения
     - Под заглушкой указывается ссылка на источник (URL из списка оборудования или поисковый запрос) для последующего поиска

### 10. Командировочные расходы
- **Базовая локация:** Екатеринбург. Для расчёта поездок определяем расстояние и длительность командировки.
- **Транспорт:**  
  - поезд (плацкарт/купе) — фактическая стоимость билетов × количество сотрудников;  
  - авиаперелёт — эконом-тариф + багаж;  
  - автомобиль — 14 ₽/км + топливо по нормативу;  
  - аренда транспорта на объекте — по коммерческим тарифам (фиксируем ссылку).
- **Суточные:** 700 ₽/день на одного сотрудника (можно корректировать согласно внутренним нормам). День выезда и возврата считаются как 0.5, если отсутствуют ночёвки.
- **Проживание:** среднерыночные тарифы гостиниц/апартаментов (фиксируем источник). Стандарт — двухместное размещение для монтажников, одноместное для старшего/инженера.
- **Время в пути:** включаем в трудозатраты как отдельные смены (минимум по 1 смене на путь туда и обратно, если дорога >4 часов). Оплачиваются по базовой ставке.
- **Доп. расходы:** аренда подъёмников, допуски, страховка, спецодежда, связь. Добавляем с коэффициентом 1.1–1.15 для непредвиденных затрат.
- **Детализация:** для каждой командировки формируем отдельную Excel-таблицу (или лист) с расшифровкой статей: транспорт, суточные, проживание, время в пути (оплачиваемые часы), доп.расходы, резерв. Указываем даты, количество сотрудников, ставки/тарифы, ссылку на источник тарифа. Файл называем `Командировка_[Город]_[Дата].xlsx` и сохраняем в папке проекта.

### 10.1. Расчет стоимости доставки оборудования через API "Деловые Линии"
- **Назначение:** автоматический расчет стоимости логистики для доставки оборудования с использованием API компании "Деловые Линии" (Dellin).
- **Ключ приложения:** `433D67A0-A9D1-4293-A14C-83329023A30F` — используется для идентификации приложения при работе с публичным API.
- **Документация API:** https://dev.dellin.ru/faq/api/
- **Базовая документация:** см. папку `интеграция_с_деловыми_линиями/` в корне проекта.

#### 10.1.1. Алгоритм расчета логистики через API Dellin

1. **Определение параметров груза:**
   - Собрать данные обо всем оборудовании проекта: вес (кг), габариты (длина × ширина × высота в см)
   - Рассчитать суммарный вес и объем
   - Определить максимальные габариты (для негабаритного груза)
   - Указать города отправки и получения

2. **Поиск кодов городов (КЛАДР):**
   - Использовать метод API: `POST https://api.dellin.ru/v2/cities.json`
   - Передать параметры: `{"appkey": "433D67A0-...", "q": "Название города"}`
   - Получить код КЛАДР города из ответа
   - Кэшировать результаты для повторного использования

3. **Расчет стоимости доставки:**
   - Использовать метод API: `POST https://api.dellin.ru/v2/calculator.json`
   - Передать обязательные параметры:
     - `appkey` — ключ приложения
     - `delivery.derival.city` — код КЛАДР города отправки
     - `delivery.arrival.city` — код КЛАДР города получения
     - `cargo.weight` — вес груза в кг
     - `cargo.totalWeight` — общий вес
     - Габариты: `cargo.length`, `cargo.width`, `cargo.height` (в см)
     - `cargo.totalVolume` — объем в м³ (рассчитывается из габаритов)
     - Даты забора и доставки (формат YYYY-MM-DD)
   - Указать вариант доставки:
     - `variant: "terminal"` — доставка на терминал (требуется `terminalID`)
     - `variant: "address"` — доставка по адресу (требуется `address`)

4. **Обработка результатов:**
   - Получить стоимость доставки из поля `price.delivery`
   - Получить сроки доставки из поля `time.delivery`
   - Учесть дополнительные услуги (страхование, упаковка) при необходимости
   - Сохранить результат в расчетную таблицу с указанием:
     - Источника: `API Dellin (appkey: 433D67A0-...), дата расчета: [дата]`
     - Параметров груза (вес, объем, габариты)
     - Сроков доставки

5. **Обработка ошибок:**
   - Код ошибки 100005 — превышена частота запросов: уменьшить частоту или запросить увеличение лимита в техподдержке (https://helpdesk.dellin.ru/)
   - Отсутствие города в базе — использовать ближайший крупный город
   - Негабаритный груз — использовать параметры `oversizedWeight` и `oversizedVolume` (получить параметры через метод "Параметры негабаритного груза")

#### 10.1.2. Пример использования (Python)

См. файл `интеграция_с_деловыми_линиями/example_calculation.py` — полный пример кода для расчета стоимости доставки.

**Краткий пример:**

```python
from integration_dellin import DellinCalculator

calculator = DellinCalculator(appkey="433D67A0-A9D1-4293-A14C-83329023A30F")

# Поиск городов
from_city = calculator.find_city("Екатеринбург")
to_city = calculator.find_city("Москва")

# Расчет стоимости
result = calculator.calculate_cost(
    from_city_code=from_city["code"],
    to_city_code=to_city["code"],
    weight_kg=4104,  # вес LED-экрана 9×12м
    length_cm=900,
    width_cm=1200,
    height_cm=50
)

cost = result["price"]["delivery"]  # стоимость доставки
```

#### 10.1.3. Интеграция с расчетом закупки оборудования

- При расчете стоимости закупки оборудования (раздел 7) использовать API Dellin для расчета логистики вместо фиксированных нормативов (2–5% от стоимости оборудования).
- Расчет логистики выполнять после определения полного списка оборудования и его параметров.
- Сохранять результаты расчета в лист "Доставка" Excel-файла проекта с детализацией:
  - Город отправки
  - Город получения
  - Параметры груза (вес, объем, габариты)
  - Стоимость доставки
  - Сроки доставки
  - Источник расчета (API Dellin с датой)

#### 10.1.4. Лимиты и ограничения

- **Лимит запросов:** по умолчанию для публичного API ограничено количество запросов в минуту. При превышении лимита запрос увеличения в техподдержке (https://helpdesk.dellin.ru/).
- **Тестовая среда:** отсутствует. Для тестирования использовать черновики (`inOrder: false`) или предзаказы на терминал.
- **Учет скидок:** для учета персональных скидок необходимо передавать `sessionID` (получается через метод авторизации) и `requester.uid` (UID контрагента).

#### 10.1.5. Техническая поддержка

- **Email:** api_support@dellin.ru
- **Портал поддержки:** https://helpdesk.dellin.ru/
- **Документация:** https://dev.dellin.ru/faq/api/
- **Дополнительная информация:** см. `интеграция_с_деловыми_линиями/README.md`

### 11. Определение численности бригады
- Исходная численность определяется по шаблону операции. Корректируем:
  - если единица оборудования >80 кг → минимум 3 монтажника;
  - при параллельной установке нескольких зон (несколько залов) — добавляем дополнительную бригаду на каждую независимую площадку;
  - работы на высоте >10 м или с подъёмниками требуют отдельного ответственного за безопасность (добавить 0.5 ставки прораба на смену).
- Общая численность = сумма по операциям, объединённых по сменам. Оптимизируем график: одна бригада может выполнять последовательные работы, если сроки позволяют.

### 12. Формирование сметы
0. **Обязательное требование к указанию источников цен:** при подборе оборудования для каждой позиции **обязательно указывать точный источник цены:**
   - **Для оборудования из прайсов:** полное название файла прайса, название листа (если применимо) и номер строки. Формат: `[Название_файла.xlsx], лист "[Название_листа]", строка [номер]`. Пример: `Intrend_звуковое оборудование_прайс-лист_210725.xlsx, лист "Лист1", строка 45`
   - **Для оборудования из интернета:** полная ссылка (URL) на страницу товара и цена на момент поиска. Формат: `[Полная ссылка] - цена [сумма] руб (на [дата])`. Пример: `https://www.auvix.ru/catalog/zvukovoe-oborudovanie/miksheery/midas-m32r/ - цена 450000 руб (на 20.11.2025)`
   - Источник указывается в колонке "Источник" в таблице расчета оборудования
   - Это требование обеспечивает прозрачность расчетов и возможность проверки/пересчета цен
0.1. **Структурированная задача инженера в начале документа:** каждый расчетный документ (PDF, Markdown) должен начинаться с четко структурированной задачи инженера, которая включает:
   - **Объект:** название объекта, адрес, тип помещения/площадки
   - **Цель проекта:** что требуется реализовать (например, "Оснащение музыкального зала звуковым оборудованием")
   - **Входные данные:** список оборудования, технические требования, условия объекта
   - **Ограничения и требования:** сроки, бюджетные ограничения, особые условия (монтаж не требуется, только доставка, консультация включена и т.д.)
   - **Ожидаемый результат:** что должно быть получено в итоге (комплект оборудования, расчет стоимости, спецификация и т.д.)
   - **Дополнительная информация:** ИНН заказчика, адрес доставки, сроки реализации, особые пожелания
   
   Задача должна быть оформлена в виде структурированного списка или таблицы в начале документа, перед любыми расчетами и таблицами. Это обеспечивает понимание контекста проекта и требований заказчика.
0.2. **Двойная проверка результатов подбора оборудования и ссылок на источники:** перед финализацией расчета **обязательно выполнить двойную проверку** всех результатов подбора оборудования и ссылок на источники. Проверка выполняется в два этапа:
   - **Первая проверка (автоматическая/самопроверка):**
     - Проверить, что все позиции оборудования имеют заполненный источник цены (колонка "Источник" не пустая)
     - Проверить формат источников: для прайсов — наличие файла, листа и номера строки; для интернета — наличие полной ссылки, цены и даты
     - Проверить соответствие номеров позиций: убедиться, что источник относится к правильной позиции (проверка: `assert int(row['№']) == pos_num` для каждой строки)
     - Проверить, что все источники из прайсов указывают на существующие файлы и строки (выборочная проверка минимум 3-5 позиций)
     - Проверить, что все интернет-ссылки доступны и содержат актуальную информацию (выборочная проверка минимум 3-5 позиций)
     - Проверить соответствие цен в источниках и ценам в таблице расчета
     - Проверить, что все позиции из входной спецификации присутствуют в расчете
     - Проверить, что нет дублирования позиций с разными источниками
   - **Вторая проверка (контрольная, независимая):**
     - Выполняется другим специалистом (не тем, кто делал подбор) или руководителем
     - Проверяет выборочно (минимум 30% позиций) соответствие источников и цен
     - Проверяет логику выбора оборудования (соответствие сегменту, брендам, требованиям)
     - Проверяет наличие всех обязательных элементов в источниках (для прайсов: файл+лист+строка; для интернета: ссылка+цена+дата)
     - Проверяет актуальность цен (даты в источниках не старше 3 месяцев для интернет-источников)
     - Проверяет, что источники в PDF соответствуют источникам в Excel
     - Фиксирует найденные несоответствия в отдельном списке для исправления
   - **Результат проверки:**
     - Все найденные несоответствия должны быть исправлены до финализации расчета
     - Проверка должна быть задокументирована (кто проверял, когда, какие позиции проверены, результаты)
     - При обнаружении критических ошибок (неправильные источники, несоответствие позиций) расчет возвращается на доработку
   - **Норматив времени на проверку:**
     - Первая проверка (самопроверка): 0.15 часа на позицию оборудования
     - Вторая проверка (контрольная): 0.1 часа на позицию оборудования
     - Исправление найденных ошибок: 0.2 часа на каждую найденную ошибку
1. Собираем таблицу с колонками: `Наименование операции`, `Кол-во`, `Трудозатраты (чел.-ч)`, `Состав бригады`, `Часы по ролям`, `Ставка`, `Стоимость`, `Командировочные`, `Прочие расходы`, `Комментарий`.
2. Итог по трудозатратам: сумма стоимости всех ролей.
3. Итог по командировкам: транспорт + проживание + суточные.
4. Добавляем блок `Закуп`: стоимость оборудования + трудозатраты закупа + логистика + резерв.
5. Добавляем накладные (`10–15 %`) и плановую маржу (на усмотрение руководителя).
6. Сводим в итоговую строку: `Трудовая часть`, `Командировочные`, `Закуп`, `Прочие`, `Накладные`, `Маржа`, `Сумма к выставлению`.
7. Прилагаем список допущений, ссылок на тарифы и расчёт численности.
8. **Расписываем каждую операцию монтажа отдельной строкой**: указываем состав работ, объём, трудозатраты по ролям, коэффициенты сложности, используемое оборудование/инструмент; для каждой позиции добавляем короткое обоснование выбора (почему выбран именно такой способ монтажа, состав бригады, коэффициенты, оборудование). Обоснование фиксируем либо в столбце `Комментарий`, либо отдельным текстовым блоком сразу под таблицей.
9. **Детализация командировочных и прочих расходов:** создаём отдельные Excel-таблицы (файлы или листы) `Командировочные_[Проект].xlsx` и `Прочие_расходы_[Проект].xlsx`, где каждая строка содержит статью расходов, объём (км, дней, часов, шт.), ставку, ссылку на источник и сумму. Итоги из этих таблиц должны совпадать со строками `Командировочные` и `Прочие` в основной смете; ссылки на файлы добавляем в комментарии или примечания.
10. **Обоснование выбора оборудования и техническое описание:** перед формированием коммерческого предложения включаем в расчёт текстовый блок, где указываем:
    - **выбранный сегмент оборудования** (бюджетный, среднебюджетный или премиальный) и обоснование выбора этого сегмента для проекта;
    - критерии выбора оборудования (условия объекта, требования по мощности, защите, интеграции, стоимости);
    - соответствие всех позиций выбранному сегменту и брендам этого сегмента;
    - альтернативы и причины отказа (если были), с указанием, почему они не соответствуют выбранному сегменту.
    **Важно:** все позиции в КП должны относиться к одному сегменту. Смешивание бюджетного и премиального оборудования в одном КП запрещено. Если требуется предложить несколько вариантов — создаются отдельные КП для каждого сегмента.
    После сметы добавляем краткое техническое описание ключевых позиций: основные характеристики, условия эксплуатации, требования к размещению. Текст должен быть пригоден для вставки в КП и сопровождаться ссылками на прайс или паспорт.

#### 12.1. Требования к оформлению таблиц в Markdown и PDF
- **Структура таблиц:**
  - все таблицы должны быть оформлены в формате Markdown с использованием символов `|` для разделения колонок;
  - обязательна строка-разделитель с `---` между заголовком и данными;
  - выравнивание колонок: числа по правому краю (`---:`), текст по левому (`:---`), центр (`:---:`);
  - заголовки колонок должны быть понятными и краткими (при необходимости использовать сокращения с расшифровкой в примечаниях).
- **Форматирование данных:**
  - числовые значения с разделителями тысяч: `1 234 567` или `1,234,567` (единообразно в рамках документа);
  - валютные значения с указанием единицы: `125 000 ₽` или `125,000 руб`;
  - проценты: `12 %` или `12%` (единообразно);
  - даты в формате `ДД.ММ.ГГГГ` или `ГГГГ-ММ-ДД`.
- **Визуальное оформление:**
  - для важных итоговых строк использовать выделение (жирный шрифт в Markdown: `**текст**`);
  - группировать связанные данные (например, все операции монтажа, затем все операции ПНР);
  - использовать пустые строки для визуального разделения блоков таблицы;
  - при большом количестве колонок — разбивать таблицу на несколько связанных таблиц или использовать переносы строк в ячейках.
- **Для PDF:**
  - при генерации PDF из Markdown использовать моноширинный шрифт (Courier, Courier New) для таблиц для сохранения выравнивания;
  - проверять, что таблицы не обрезаются на краях страницы;
  - при необходимости использовать альбомную ориентацию для широких таблиц;
  - итоговые строки должны быть визуально выделены (жирный шрифт, возможно, фон другого цвета при использовании инструментов генерации PDF).
- **Контроль качества:**
  - перед финальной версией проверить читаемость таблиц на экране и при печати;
  - убедиться, что все числовые значения выровнены по правому краю;
  - проверить, что итоговые суммы совпадают с детальными расчётами;
  - таблицы должны быть самодостаточными (понятны без дополнительных пояснений в тексте).

#### 12.2. Правило формирования цен с указанием входной стоимости
- **Обязательное требование:** все цены в расчётных таблицах должны содержать указание на тип цены:
  - **Входная цена** — цена закупки оборудования у поставщика (без наценки);
  - **Выходная цена** — цена для клиента (с наценкой, накладными, маржой).
- **Формат указания:**
  - в таблицах использовать колонки: `Цена_входная_руб`, `Цена_выходная_руб` или `Цена_закуп_руб`, `Цена_клиенту_руб`;
  - в текстовых описаниях явно указывать: "Входная цена: X руб", "Цена для клиента: Y руб";
  - для монтажных работ всегда указывать входные цены (стоимость работ без наценки).
- **Принцип расчёта:**
  - по работам (монтаж, ПНР, обучение) считаем входные цены — это базовая стоимость без наценки;
  - на входные цены работ начисляются накладные расходы и маржа для получения выходной цены;
  - оборудование: входная цена = цена из прайса поставщика, выходная = входная + наценка + накладные + маржа.
- **Пример оформления:**
  ```
  | Позиция | Входная цена, ₽ | Наценка, ₽ | Накладные, ₽ | Маржа, ₽ | Выходная цена, ₽ |
  |---------|----------------:|-----------:|-------------:|---------:|-----------------:|
  | Монтаж LED-экрана | 126 000 | 0 | 15 120 | 28 224 | 169 344 |
  ```

#### 12.3. Формирование итоговых документов проекта

**Обязательное требование:** на выходе каждого проекта должны быть созданы **четыре итоговых документа**. **Отсутствие любого из этих документов является критической системной ошибкой, которая требует немедленного исправления:**

1. **Один PDF документ** с полным описанием проекта:
   - **В начале документа:** логотип ММВС (если доступен) и контактный телефон 8-800-200-12-31
   - Структурированная задача инженера
   - Обоснование выбора оборудования
   - Расчет оборудования с картинками (для каждой ключевой позиции)
   - **Структурная схема соединения компонентов** — обязательный раздел, который должен быть включен в PDF коммерческого предложения. Схема должна наглядно показывать все основные компоненты системы, их взаимосвязи, типы соединений (аналоговые, цифровые, сетевые, силовые), направления сигналов, точки подключения. Схема может быть выполнена в виде блок-схемы, функциональной схемы или принципиальной схемы соединений. Схема должна быть понятной для заказчика и монтажников, содержать обозначения всех ключевых компонентов из спецификации оборудования. **КРИТИЧЕСКИ ВАЖНО: схема должна быть детализирована покомпонентно без объединений в группы.** Каждый компонент должен быть показан отдельно, даже если их несколько штук. Запрещено объединять компоненты в группы типа "Микрофоны (12)" или "Колонки (2)" — каждый микрофон и каждая колонка должны быть показаны отдельным блоком на схеме. **КРИТИЧЕСКИ ВАЖНО: провода между компонентами являются неделимыми и не могут идти по нескольку раз провода одного типа.** Если между двумя компонентами требуется несколько проводов одного типа, на схеме должен быть показан один провод с указанием количества в подписи (например, "XLR × 3", "HDMI × 2"). Запрещено показывать несколько отдельных проводов одного типа между одними и теми же компонентами. Размещается после раздела "Расчет оборудования" или в отдельном разделе "Схема соединения компонентов";
   - Техническое описание оборудования
   - Расчет доставки и прочих расходов
   - Итоговая сводная таблица
   - Все таблицы и расчеты должны быть включены в PDF
   - Картинки оборудования должны быть встроены в документ рядом с описанием соответствующей позиции

2. **Один DOC документ** (Microsoft Word) с коммерческим предложением (КП):
   - Название файла: `КП_[Название_проекта].docx` или `КП_[Название_проекта].doc`
   - **В начале документа:** логотип ММВС (если доступен) и контактный телефон 8-800-200-12-31
   - Структурированная задача инженера
   - Обоснование выбора оборудования (сегмент, критерии выбора)
   - Краткое описание решения
   - Расчет оборудования (таблица с позициями, количеством, ценами, источниками)
   - Расчет монтажных работ (если применимо)
   - Расчет доставки и прочих расходов
   - Итоговая сводная таблица с финальной стоимостью
   - Техническое описание ключевого оборудования
   - **Структурная схема соединения компонентов** — обязательный раздел (может быть в виде изображения, экспортированного из Visio)
   - Все таблицы должны быть отформатированы и читабельны
   - Картинки оборудования должны быть встроены в документ рядом с описанием соответствующей позиции
   - Документ должен быть готов для отправки заказчику (проверен на опечатки, форматирование, читабельность)
   - **Важно:** DOC файл формируется на основе PDF документа, но адаптирован для отправки заказчику (более презентабельный формат, удобный для редактирования и корректировок)

3. **Один XLSX документ** со всеми расчетами для редактирования:
   - Лист "Оборудование" — детальный расчет всех позиций оборудования с входными ценами
   - Лист "Доставка" — детальная расшифровка всех статей доставки
   - Лист "Командировочные" — детальная расшифровка командировочных расходов (если применимо)
   - Лист "Прочие расходы" — детальная расшифровка прочих расходов
   - Лист "Поиск оборудования" — результаты поиска и сравнения вариантов
   - Лист "Сводная таблица" — итоговая сводка всех затрат
   - Все расчеты должны быть детально расписаны с указанием источников, нормативов, коэффициентов
   - Формулы должны быть сохранены для возможности пересчета

4. **Один файл структурной схемы в формате Visio** (`.vsdx` или `.vsd`):
   - Название файла: `Схема_соединений_[Название_проекта].vsdx`
   - Схема должна содержать все компоненты из спецификации оборудования
   - Все соединения должны быть показаны с указанием типов кабелей/интерфейсов
   - Схема должна быть структурирована по функциональным или физическим зонам
   - Должна содержать легенду с расшифровкой обозначений
   - Схема должна быть пригодна для печати на формате A3 или A4
   - Все надписи должны быть на русском языке
   - Схема должна быть сохранена в последней версии формата Visio для совместимости

**Правила детализации затрат:**
- Каждая статья расходов должна быть расписана максимально детально
- Указывать: количество, единицу измерения, цену за единицу, источник цены, норматив или обоснование
- Для командировочных: расписывать транспорт (км × тариф), суточные (дни × ставка), проживание (ночи × тариф)
- Для доставки: расписывать расстояние, тариф за км, погрузку/разгрузку, страхование (процент от стоимости)
- Для оборудования: указывать источник (прайс, лист, строка) или ссылку на интернет-источник
- Все коэффициенты и нормативы должны быть указаны явно

**Правила работы с генерацией PDF файлов:**

**КРИТИЧЕСКИ ВАЖНО: Использование Paragraph для ячеек таблиц с форматированием:**
- **Проблема:** В ReportLab, если передавать HTML-теги (например, `<b>жирный текст</b>`) как обычные строки в таблицу, они не обрабатываются и выводятся как обычный текст.
- **Проблема:** Если не использовать Paragraph для ячеек таблиц, русский текст может пропадать из-за отсутствия правильного шрифта в ячейках.
- **Решение:** Все ячейки таблиц должны создаваться как объекты `Paragraph`, а не обычные строки.
- **Пример правильного создания таблицы:**
  ```python
  # НЕПРАВИЛЬНО (HTML теги и русский текст могут пропадать):
  equipment_data.append([
      "", "", "", "<b>ИТОГО:</b>", "",
      f"<b>{total:,.0f}</b>"
  ])
  
  # ПРАВИЛЬНО (используем Paragraph для всех ячеек):
  style_table_total = ParagraphStyle(...)
  total_row = [
      Paragraph("", style_table_cell),
      Paragraph("", style_table_cell),
      Paragraph("", style_table_cell),
      Paragraph("<b>ИТОГО:</b>", style_table_total),  # HTML обрабатывается
      Paragraph("", style_table_cell),
      Paragraph(f"<b>{total:,.0f}</b>", style_table_total)  # HTML обрабатывается
  ]
  equipment_data.append(total_row)
  ```
- **Обязательные стили для таблиц:**
  - `style_table_cell` - для обычных ячеек с поддержкой кириллицы
  - `style_table_cell_right` - для ячеек с числами (выравнивание вправо)
  - `style_table_header` - для заголовков таблиц
  - `style_table_total` - для итоговых строк с жирным шрифтом
- **Шрифты:** Обязательно регистрировать шрифты с поддержкой кириллицы (Arial, Arial-Bold) и использовать их во всех стилях таблиц.

**Правила работы с картинками оборудования:**
- **ОБЯЗАТЕЛЬНО:** Для каждой ключевой позиции оборудования необходимо найти и скачать изображение из интернета либо поставить заглушку
- **Поиск изображений:** Изображения оборудования необходимо искать в интернете на приоритетных ресурсах (snk-s.ru, auvix.ru, digis.ru, hi-tech-media.ru) или в общем интернете
- **Заглушка:** Если изображение не найдено в интернете, необходимо поставить заглушку (стандартное изображение-заглушку с текстом "Изображение не найдено" или схематичное изображение оборудования)
- Картинки сохраняются в папке проекта в подпапку `img/`
- Имена файлов: `[Номер_позиции]_[Краткое_название].jpg` или `.png` (например: `01_Midas_M32R.jpg`)
- В PDF картинки размещаются рядом с описанием соответствующей позиции оборудования
- **Если изображение найдено и скачано:** вставляется реальное изображение из папки `img/`
- **Если изображение не найдено:** вставляется заглушка из папки `img/` или создается стандартная заглушка с текстом "Изображение не найдено" и ссылкой на источник (URL из списка оборудования или поисковый запрос)
- Под каждой картинкой или ссылкой указывается источник (ссылка на сайт, откуда скачано изображение или где его можно найти)
- **Размер картинок в PDF: фиксированный 150x150 пикселей** (для сохранения структуры таблиц и единообразия)
- Зазоры между абзацами должны быть минимальными (5-8 мм), чтобы документ был компактным
- **Переносы абзацев должны быть удалены** - текст должен быть оформлен без разрывов строк внутри абзацев для красивого внешнего вида PDF
- **Правильная привязка источников цен к позициям оборудования:**
  - Источник цены должен быть вставлен строго под соответствующей позицией оборудования
  - **Обязательное требование:** при вставке источника в PDF необходимо гарантировать, что источник берется из той же строки DataFrame/Excel, что и позиция оборудования
  - В коде генерации PDF необходимо добавить проверку соответствия: `assert int(row['№']) == pos_num` для гарантии правильной привязки
  - Источник должен вставляться после изображения оборудования (если изображение есть) или на месте изображения (если изображение отсутствует)
  - Расчет координат для вставки источника должен учитывать наличие/отсутствие изображения:
    - Если изображение найдено: `source_y = img_y - 10` (под изображением)
    - Если изображение не найдено: `source_y = row_y - IMG_SIZE_MM - 10` (на месте изображения)
  - Ширина текста для источников должна быть достаточной для отображения длинных ссылок (не менее 160 символов или ширина всей таблицы минус отступы)
  - Использовать правильный размер шрифта для источников (не менее 7pt, лучше 8pt) для читаемости
  - Правильно рассчитывать высоту строки таблицы с учетом источника, чтобы источники не перекрывались с другими позициями
  - При многострочных источниках правильно учитывать количество строк при расчете высоты строки таблицы
  - **Критическая ошибка:** если источник вставляется не под той позицией, к которой он относится, это нарушает целостность документа и может привести к неправильному пониманию расчетов

**Структура папки проекта:**
```
Проект_[Название]/
├── TODO.md                      # Файл отслеживания выполненных работ (обязательный)
├── img/                          # Папка с картинками оборудования
│   ├── 01_Midas_M32R.jpg
│   ├── 02_Микрофон_Октава.jpg
│   └── ...
├── Расчет_[Название_проекта].pdf  # Единый PDF документ
├── КП_[Название_проекта].docx    # Коммерческое предложение в формате Word
├── Расчет_[Название_проекта].xlsx # Единый XLSX документ со всеми расчетами
└── Схема_соединений_[Название_проекта].vsdx  # Структурная схема в формате Visio
```

**Правило работы с TODO.md файлом:**
- TODO.md файл должен создаваться в начале работы над проектом
- Файл содержит список всех задач проекта с отметками о выполнении
- Формат отметок: `[ ]` - не выполнено, `[x]` - выполнено
- TODO файл должен обновляться на каждом этапе работы
- При завершении этапа задача отмечается как выполненная `[x]`
- TODO файл должен оставаться в папке проекта после завершения работы (как история выполнения проекта)
- Скрипт `create_todo.py` должен создавать/обновлять TODO файл при запуске
- **ОБЯЗАТЕЛЬНО: В конец TODO.md файла должна быть добавлена инструкция по удалению служебных файлов расчета проекта**, чтобы мусор удалялся. Эта инструкция должна быть в конце файла после всех секций и заметок, чтобы исполнитель знал, какие файлы нужно удалить после завершения проекта

**КРИТИЧЕСКИ ВАЖНО для ИИ‑агента (Ассистента) при работе с TODO.md:**
- **Обязательное выполнение всех автоматических задач:** Агент должен выполнять все задачи из `TODO.md`, которые могут быть выполнены автоматически или с помощью Агента, пока не будут отмечены как выполненные `[x]`.
- **Непрерывная работа:** Агент не должен прекращать работу над проектом, если в `TODO.md` остались невыполненные задачи, которые можно выполнить. Работа должна продолжаться до завершения всех автоматически выполнимых задач.
- **Проверка перед завершением:** Перед завершением работы над проектом Агент обязан:
  1. Открыть файл `TODO.md` проекта
  2. Проверить все задачи на предмет возможности их автоматического выполнения
  3. Выполнить все доступные автоматические задачи
  4. Обновить `TODO.md`, отметив выполненные задачи как `[x]`
  5. Убедиться, что все автоматически выполнимые задачи завершены
- **Исключения:** Задачи, которые требуют ручной работы (например, "требуется ручной поиск оборудования на приоритетных ресурсах", "требует независимого специалиста") могут остаться невыполненными, но должны быть четко отмечены в итоговом отчете.
- **Итоговый отчет:** После завершения всех автоматических задач Агент должен предоставить итоговый отчет о выполненных и оставшихся задачах из `TODO.md`.

**Запрещено:**
- Создавать множественные PDF, DOC или XLSX файлы для одного проекта (один файл каждого типа на проект)
- Оставлять промежуточные файлы расчетов (они должны быть объединены в итоговые документы)
- Размещать картинки вне папки `img/`
- Использовать картинки без указания источника
- Отправлять заказчику PDF вместо DOC (DOC файл предназначен для отправки заказчику, PDF — для внутреннего использования)
- Удалять TODO.md файл после завершения проекта (он остается как история)

**Очистка проекта после завершения:**
- После формирования итоговых документов (PDF, DOC, XLSX и Visio) необходимо удалить все промежуточные файлы:
  - Скрипты генерации (`.py` файлы)
  - Промежуточные Excel файлы (если они были объединены в итоговый XLSX)
  - Временные файлы и черновики
- В папке проекта должны остаться только:
  - `TODO.md` - файл отслеживания выполненных работ (обязательно, содержит историю выполнения проекта)
  - `Расчет_[Название_проекта].pdf` - итоговый PDF документ (для внутреннего использования)
  - `КП_[Название_проекта].docx` - коммерческое предложение в формате Word (для отправки заказчику)
  - `Расчет_[Название_проекта].xlsx` - итоговый XLSX документ со всеми расчетами
  - `Схема_соединений_[Название_проекта].vsdx` - структурная схема в формате Visio
  - `img/` - папка с изображениями оборудования
  - `equipment_list.json` - список оборудования (опционально, для справки)

**Алгоритм формирования итоговых документов:**
1. **Создать TODO.md файл в папке проекта** для отслеживания выполненных работ:
   - Файл должен содержать список всех задач проекта с отметками о выполнении
   - Формат: `[ ]` - не выполнено, `[x]` - выполнено
   - Пример структуры TODO файла:
     ```
     TODO - Проект: [Название проекта]
     Дата создания: [дата]
     
     ОСНОВНЫЕ ЭТАПЫ:
     [ ] Создать структуру проекта
     [ ] Сформировать структурированную задачу инженера
     [ ] Определить сегмент оборудования
     [ ] Подобрать оборудование в прайсах
     [ ] Поиск недостающего оборудования в интернете
     [ ] Создать Excel файл со всеми расчетами
     [ ] Найти и скачать изображения оборудования
     [ ] Создать PDF документ
     [ ] Создать DOC документ (КП)
     [ ] Создать структурную схему в Visio
     [ ] Выполнить первую проверку (самопроверка)
     [ ] Выполнить вторую проверку (контрольная)
     [ ] Исправить найденные ошибки
     [ ] Удалить промежуточные файлы
     
     ИТОГОВЫЕ ДОКУМЕНТЫ:
     [ ] PDF документ создан
     [ ] DOC документ (КП) создан
     [ ] XLSX документ создан
     [ ] Visio схема создана
     
     ════════════════════════════════════════════════════════════
     ИНСТРУКЦИЯ ПО УДАЛЕНИЮ СЛУЖЕБНЫХ ФАЙЛОВ ПРОЕКТА
     ════════════════════════════════════════════════════════════
     
     После завершения проекта и формирования всех итоговых документов
     необходимо удалить следующие служебные файлы расчета:
     
     УДАЛИТЬ:
     - Все скрипты генерации (*.py файлы):
       * create_*.py
       * generate_*.py
       * search_*.py
       * perform_*.py
       * finalize_*.py
       * и другие служебные Python скрипты
     - Промежуточные JSON файлы (если они были объединены в итоговые документы):
       * equipment_search_results.json
       * check_results.json
       * calculation_data.json (если все данные включены в XLSX)
       * equipment_list.json (если все данные включены в XLSX)
     - Временные файлы и черновики:
       * *.tmp
       * *.bak
       * *.old
       * любые файлы с суффиксами _backup, _copy и т.д.
     - Промежуточные Excel файлы (если они были объединены в итоговый XLSX)
     - Файлы схем в промежуточных форматах (если создан итоговый VSDX):
       * *.svg (оставить только если VSDX не создан)
       * Схема_соединений_описание.txt (оставить только если нет VSDX)
     
     ОСТАВИТЬ В ПАПКЕ ПРОЕКТА:
     - TODO.md - файл отслеживания работ (обязательно, содержит историю)
     - Расчет_[Название_проекта].pdf - итоговый PDF документ
     - КП_[Название_проекта].docx - коммерческое предложение (DOC)
     - Расчет_[Название_проекта].xlsx - итоговый XLSX документ
     - Схема_соединений_[Название_проекта].vsdx - структурная схема Visio
     - img/ - папка с изображениями оборудования
     - engineer_task.json - структурированная задача инженера (опционально, для справки)
     ```
   - TODO файл должен обновляться на каждом этапе работы
   - При завершении этапа задача отмечается как выполненная `[x]`
   - TODO файл должен оставаться в папке проекта после завершения работы
   - **В конец TODO.md файла автоматически добавляется инструкция по удалению служебных файлов** (скрипт `create_todo.py` должен добавлять эту секцию в конец файла)
2. Собрать все расчеты в единый XLSX файл с несколькими листами
3. Найти и скачать картинки оборудования в папку `img/`
3. **ОБЯЗАТЕЛЬНО: Сформировать PDF документ** со всеми расчетами, обоснованием и схемами
   - Создать скрипт генерации PDF (например, `generate_pdf_doc.py` или отдельный скрипт `generate_pdf.py`)
   - Скрипт должен читать данные из `calculation_data.json` и `engineer_task.json`
   - Скрипт должен создавать файл `Расчет_[Название_проекта].pdf` согласно требованиям раздела 12.3
   - **Критическая ошибка:** если PDF не создан, проект считается незавершенным и требует исправления
4. **ОБЯЗАТЕЛЬНО: Сформировать DOC документ (КП)** на основе PDF, адаптированный для отправки заказчику:
   - Создать скрипт генерации DOC (например, в том же `generate_pdf_doc.py` или отдельный скрипт `generate_doc.py`)
   - Скрипт должен читать те же данные из `calculation_data.json` и `engineer_task.json`
   - Скрипт должен создавать файл `КП_[Название_проекта].docx` согласно требованиям раздела 12.3
   - **Критическая ошибка:** если DOC не создан, проект считается незавершенным и требует исправления
   - Экспортировать содержимое из PDF или создать новый документ Word
   - Применить корпоративный стиль и форматирование
   - Убедиться, что все таблицы читабельны и отформатированы
   - Проверить, что все картинки вставлены корректно
   - Проверить документ на опечатки и форматирование
5. **Выполнить первую проверку (самопроверка) результатов подбора оборудования и ссылок:**
   - **Проверка реального наличия в прайс-листах:** для каждой позиции, источник которой указывает на прайс-лист, проверить реальное наличие позиции в указанной строке. Если позиция не найдена в строке или строка не существует, это критическая ошибка — требуется поиск в интернете и обновление источника.
   - Проверить, что все позиции имеют заполненный источник цены
   - Проверить формат источников (прайсы: файл+лист+строка; интернет: ссылка+цена+дата)
   - Проверить соответствие номеров позиций и источников
   - Выборочно проверить существование файлов прайсов и строк (минимум 3-5 позиций)
   - Выборочно проверить доступность интернет-ссылок (минимум 3-5 позиций)
   - Проверить соответствие цен в источниках и ценам в таблице
   - Проверить наличие всех позиций из входной спецификации
   - Проверить, что все источники цен указаны корректно (нет ссылок на несуществующие позиции)
   - Исправить все найденные ошибки
4. **Разработать структурную схему соединения компонентов в формате Visio:**
   - Создать новый файл Visio (`.vsdx`)
   - Добавить все компоненты из спецификации оборудования в виде блоков (покомпонентно, без группировки)
   - Для каждого компонента указать название, модель и основные порты/разъемы
   - Соединить компоненты линиями со стрелками, показывающими направление сигналов
   - **Правило неделимости проводов:** провода между компонентами являются неделимыми и не могут идти по нескольку раз провода одного типа. Если между двумя компонентами требуется несколько проводов одного типа (например, 3 XLR кабеля, 2 HDMI кабеля), показать один провод с указанием количества в подписи (например, "XLR × 3", "HDMI × 2"). Запрещено показывать несколько отдельных проводов одного типа между одними и теми же компонентами
   - Подписать каждое соединение типом кабеля/интерфейса (HDMI, USB, RJ45, XLR, LAN и т.д.) и количеством, если проводов несколько
   - Сгруппировать компоненты по функциональным зонам (входы, обработка, выходы) или физическим зонам (только как области расположения, сами компоненты должны быть показаны отдельно)
   - Добавить легенду с расшифровкой типов соединений
   - Применить цветовое кодирование для разных типов сигналов (рекомендуется)
   - Проверить читаемость всех надписей (размер шрифта не менее 8pt)
   - Сохранить файл как `Схема_соединений_[Название_проекта].vsdx`
6. Создать упрощенную версию схемы для включения в PDF и DOC (может быть экспортирована из Visio или создана отдельно)
7. Сформировать единый PDF документ, включающий:
   - Структурированную задачу инженера
   - Все расчеты с таблицами
   - Картинки оборудования рядом с описанием
   - **Структурную схему соединения компонентов** (упрощенная версия для PDF, обязательный элемент)
   - Техническое описание
   - Итоговую сводку
8. Сформировать DOC документ (КП) для заказчика:
   - Создать новый документ Word или преобразовать PDF в Word
   - Включить все разделы из PDF: задача инженера, обоснование, расчеты, схемы
   - Применить профессиональное форматирование (заголовки, таблицы, изображения)
   - Убедиться, что документ читабелен и презентабелен для отправки заказчику
   - Проверить на опечатки и корректность всех данных
   - Сохранить как `КП_[Название_проекта].docx`
9. **Выполнить вторую проверку (контрольная, независимая) результатов подбора и ссылок:**
   - Проверить выборочно (минимум 30% позиций) соответствие источников и цен
   - Проверить логику выбора оборудования (соответствие сегменту, брендам, требованиям)
   - Проверить наличие всех обязательных элементов в источниках
   - Проверить актуальность цен (даты не старше 3 месяцев для интернет-источников)
   - Проверить, что источники в PDF и DOC соответствуют источникам в Excel
   - Проверить, что источники в PDF и DOC привязаны к правильным позициям
   - Проверить соответствие данных в PDF и DOC документах
   - Зафиксировать найденные несоответствия в списке для исправления
   - При обнаружении критических ошибок — вернуть расчет на доработку
10. Исправить все найденные во второй проверке ошибки
11. Проверить, что все данные в PDF и DOC соответствуют данным в XLSX
12. Проверить, что схема в Visio содержит все компоненты из спецификации и все соединения корректны
13. Убедиться, что DOC файл готов для отправки заказчику (проверка форматирования, читабельности)
14. Удалить промежуточные файлы (если они были созданы)

#### 12.4. Методика расчёта стоимости LED-экранов (на основе калькулятора calcmmvs.ru)
- **Назначение:** единый алгоритм расчёта стоимости светодиодных экранов с учётом всех компонентов и работ.
- **Входные параметры:**
  - размеры места под экран (ширина и высота в мм);
  - тип исполнения (внутренний/наружный);
  - шаг пикселя (определяет модель модуля);
  - технология (SMD, SOFT MASK, SMD GOLD, GOB);
  - тип обслуживания (фронтальное/тыльное);
  - размер кабинета;
  - герцовка (1920, 2880, 3360, 3840, 7680 Гц);
  - курс валюты (руб./$);
  - ставка НДС (0% или 5%);
  - город доставки (для расчёта логистики).
- **Алгоритм расчёта:**
  1. **Определение количества кабинетов:**
     - `кабинетов_по_ширине = округление_вверх(ширина_места / ширина_кабинета)`;
     - `кабинетов_по_высоте = округление_вверх(высота_места / высота_кабинета)`;
     - `всего_кабинетов = кабинетов_по_ширине × кабинетов_по_высоте`;
     - размеры экрана корректируются под целое число кабинетов.
  2. **Расчёт модулей:**
     - `модулей_в_кабинете = (ширина_кабинета / ширина_модуля) × (высота_кабинета / высота_модуля)`;
     - `всего_модулей = всего_кабинетов × модулей_в_кабинете`;
     - `запас_модулей = округление_вверх(всего_модулей × 3%)` (стандартный запас 3%).
  3. **Расчёт комплектующих:**
     - магниты: `всего_магнитов = всего_кабинетов × магнитов_на_кабинет` (округление до размера упаковки);
     - коннекторы: `всего_коннекторов = (всего_модулей + запас) × коннекторов_на_модуль` (округление до размера упаковки);
     - лента (ribbon): `метров_ленты = (высота_кабинета_м × коннекторов_на_модуль × 1.03) × всего_кабинетов`; `катушек = округление_вверх(метров_ленты / 75)`.
  4. **Расчёт блоков питания:**
     - `макс_ток_на_модуль` (из характеристик модуля, обычно 5 А);
     - `макс_ток_на_кабинет = макс_ток_на_модуль × модулей_в_кабинете × 1.25` (резерв 25%);
     - `блоков_питания = округление_вверх(всего_кабинетов × макс_ток_на_кабинет / мощность_блока_питания)`.
  5. **Расчёт контроллеров и приёмных карт:**
     - выбор контроллера (процессора) в зависимости от разрешения экрана и количества портов;
     - `приёмных_карт = всего_кабинетов` (по одной карте на кабинет, если не требуется больше).
  6. **Расчёт стоимости оборудования (входные цены):**
     - **ВАЖНО: Выбор варианта решения (кабинеты и модули):**
       - **Вариант А: Готовые кабинеты со встроенными модулями** — покупаем только кабинеты, модули УЖЕ включены в стоимость кабинета. В этом случае `цена_кабинетов = всего_кабинетов × цена_готового_кабинета_входная` (цена включает модули), а модули НЕ учитываем отдельно.
       - **Вариант Б: Пустые кабинеты + модули отдельно** — покупаем кабинеты (пустые корпуса) и модули отдельно. В этом случае `цена_кабинетов = всего_кабинетов × цена_пустого_кабинета_входная` и `цена_модулей = (всего_модулей + запас) × цена_модуля_входная`.
     - **СТРОГО ЗАПРЕЩЕНО** суммировать стоимость готовых кабинетов (вариант А) и отдельно модулей (вариант Б) — это приведет к двойному учету стоимости!
     - **Если требуется предложить оба варианта:** создаются отдельные вкладки в Excel-файле (например, "Вариант А: Готовые кабинеты" и "Вариант Б: Кабинеты + модули"), и в сводной таблице оба варианта указываются отдельно с пометкой "Вариант А" и "Вариант Б". В итоговой смете выбирается один вариант по согласованию с заказчиком.
     - комплектующие: `цена_комплектующих = сумма(количество × входная_цена)` для каждого типа;
     - блоки питания, контроллеры, карты: аналогично.
     - `базовая_стоимость = сумма всех компонентов выбранного варианта`.
  7. **Расчёт работ (входные цены):**
     - `площадь_экрана_м² = (ширина_экрана_мм × высота_экрана_мм) / 1 000 000`;
     - **монтажные и сборочные работы:** `монтаж_входная = площадь_экрана_м² × 5 440 руб` (норматив);
     - **металлоконструкция:** `металлоконструкция_входная = площадь_экрана_м² × 5 000 руб` (норматив);
     - логистика: задаётся вручную или рассчитывается через API на основе веса и стоимости.
  8. **Расчёт итоговой стоимости:**
     - `сумма_без_НДС = базовая_стоимость + логистика + монтаж_входная + металлоконструкция_входная`;
     - `НДС = сумма_без_НДС × ставка_НДС` (если НДС > 0);
     - `итоговая_стоимость = сумма_без_НДС + НДС`;
     - на итоговую стоимость начисляются накладные расходы и маржа для получения выходной цены.
- **Выходные данные:**
  - спецификация всех компонентов с количеством и входными ценами;
  - расчёт работ с входными ценами;
  - итоговая стоимость с разбивкой по статьям;
  - технические параметры (разрешение, энергопотребление, вес);
  - предупреждения о корректировках размеров (если были).
- **Примечания:**
  - все цены в расчёте должны быть входными (без наценки);
  - накладные расходы и маржа начисляются на итоговую сумму для получения выходной цены;
  - курс валюты используется для конвертации цен из USD в рубли (если цены в прайсах в долларах);
  - логистика может рассчитываться автоматически через API на основе города доставки, веса и стоимости.

#### 12.5. Визуализация и иллюстрации оборудования
- **Цель:** повысить наглядность расчётов и КП за счёт изображений оборудования.
- **Порядок действий:**
  1. **ОБЯЗАТЕЛЬНО:** Для каждой ключевой позиции (экраны, контроллеры, блоки питания, освещение, хейзеры и т.д.) найти актуальное изображение из открытых источников (интернет) или прайс-листа поставщика, либо поставить заглушку.
  2. **Поиск изображений:** Изображения оборудования необходимо искать в интернете на приоритетных ресурсах (snk-s.ru, auvix.ru, digis.ru, hi-tech-media.ru) или в общем интернете.
  3. **Заглушка:** Если изображение не найдено в интернете, необходимо создать и сохранить заглушку (стандартное изображение-заглушку с текстом "Изображение не найдено" или схематичное изображение оборудования) в папку `img/`.
  4. Проверить качество изображения (желательно не менее 800×600 px) и отсутствие водяных знаков, запрещённых к использованию.
  5. Указывать источник изображения (ссылка или название прайса) в отдельной колонке/примечании. Для заглушек указывать ссылку на источник поиска или поисковый запрос.
  6. Сохранять изображения (включая заглушки) в подпапке проекта `img/` (например, `Обработанный проект/Проект_X/img/`), имя файла — по кодовому названию позиции.
- **Включение в PDF:**
  - при формировании PDF (КП, методические материалы) вставлять картинки рядом с описанием позиции или в отдельный раздел «Визуализация»;
  - для больших таблиц допускается галерея (miniatures) с подписями;
  - проверять, что итоговый PDF остаётся читабельным (изображения не растягиваются и не перекрывают текст).
- **Особые требования:**
  - изображения должны соответствовать выбранной комплектации (например, одна модель контроллера — одна картинка);
  - при отсутствии официальной фотографии можно использовать схематичную визуализацию (рендер) с пометкой «пример».
  - хранить исходные файлы изображений отдельно, чтобы при обновлении КП не пришлось проводить поиск заново.

### 13. Чек-лист перед выдачей сметы
- [ ] **КРИТИЧЕСКИ ВАЖНО: Созданы ли все обязательные документы?**
  - [ ] PDF документ (`Расчет_[Название_проекта].pdf`) создан и содержит все разделы (структурированная задача инженера, обоснование, расчеты, схемы, итоговая сводка)
  - [ ] DOC документ (`КП_[Название_проекта].docx`) создан и готов для отправки заказчику
  - [ ] XLSX документ (`Расчет_[Название_проекта].xlsx`) создан со всеми расчетами на отдельных листах
  - [ ] Visio схема (`Схема_соединений_[Название_проекта].vsdx`) создана
  - **Примечание:** Отсутствие любого из этих документов - **критическая системная ошибка**, проект считается незавершенным и требует немедленного исправления. Скрипты генерации PDF и DOC должны создаваться для каждого проекта (например, `generate_pdf_doc.py`).
- [ ] Есть ли подтверждение по исходным данным (тип, количество, габариты оборудования)?
- [ ] Учтены ли все этапы: доставка, монтаж, коммутация, ПНР, обучение?
- [ ] Добавлены ли трудозатраты закупщика и логистические расходы?
- [ ] Подготовлен ли комплект документации по монтажу/соединениям и согласован ли он?
- [ ] Есть ли найденные альтернативы/поставщики по сложным позициям и зафиксированы ли их ссылки?
- [ ] Прописаны ли коэффициенты сложности с указанием причин?
- [ ] Учтены ли командировочные расходы для каждого сотрудника?
- [ ] Проверены ли ставки и часы по ролям? Нет ли «висячих» сверхурочных?
- [ ] Добавлены ли накладные и маржа?
- [ ] Внесены ли риски и допущения, требующие согласования?

### 14. Пример итоговой таблицы (фрагмент)

Пример правильно оформленной таблицы с выравниванием и форматированием:

```
| Операция | Кол-во | Монтажники (часы) | Прораб (часы) | Инженер ПНР (часы) | Стоимость, ₽ | Командировка, ₽ | Прочие, ₽ | Комментарий |
|:---------|-------:|------------------:|--------------:|-------------------:|------------:|----------------:|----------:|-------------|
| Монтаж LED-экрана 6×4 м | 1 | 120 | 40 | 16 | 126 000 | 45 000 | 20 000 | Высота 6 м, тяжёлая конструкция |
| Прокладка кабеля Cat.6 (200 м) | 1 | 24 | 8 | 0 | 20 000 | 0 | 5 000 | Коэф. за длину 1.5 |
| Настройка и обучение | 1 | 0 | 0 | 12 | 12 000 | 0 | 0 | Обучение 4 человек |
| **Итого** | | | | | **158 000** | **45 000** | **25 000** | Без накладных |
| Закуп оборудования | | | | | 1 800 000 | 50 000 | 60 000 | См. расчёт закупа |
| Накладные 12 % + маржа 20 % | | | | | **474 592** | | | |
| **Всего к выставлению** | | | | | **2 602 592** | | | |
```

**Примечания к примеру:**
- Текст выровнен по левому краю (`:---`), числа по правому (`---:`)
- Итоговые строки выделены жирным шрифтом (`**текст**`)
- Числовые значения с разделителями тысяч для удобства чтения
- Все валютные значения с указанием единицы (₽)

### 15. Автоматизация и контроль
- При использовании табличного шаблона или скрипта:
  - валидация обязательных полей;
  - справочник шаблонов операций и коэффициентов;
  - автоматическое округление часов в большую сторону до 0.5 смены;
  - отчёт о расхождении между плановым и фактическим временем (для последующих корректировок нормативов).
- Для ИИ‑агента — предоставить:
  - JSON/табличное представление входных данных;
  - список доступных операций и коэффициентов;
  - правила округления и проверки.

### 16. Обновление нормативов
- Пересматривать ставки раз в квартал с учётом рынка труда и инфляции.
- По проектам из «обратной связи» фиксировать фактические трудозатраты, обновлять базовые шаблоны.
- Все изменения оформлять в журнале изменений и утверждать техническим директором.
